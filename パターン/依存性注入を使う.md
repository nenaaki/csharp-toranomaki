## DI（依存性注入）を用いるべき理由

### DI（Dependency Injection）とは何ですか？

DI（Dependency Injection）は、ソフトウェア設計のパターンの一つであり、クラスの依存関係を外部から注入することで、コードの柔軟性や再利用性、テストの容易さを向上させる手法です。DIは、依存性の注入とも呼ばれます。

#### DIの主な利点

1. **結合の緩和**:
    - クラスが直接依存するオブジェクトを自ら作成するのではなく、外部から提供されるため、クラス間の結合が緩和されます。これにより、コードの変更が他のクラスに影響を与えにくくなります。

1. **テストの容易さ**:
    - テストコードを書く際に、依存関係をモック（模擬オブジェクト）に置き換えることが容易になります。これにより、単体テストが簡単に実行できます。

1. **再利用性の向上**:
    - 依存関係を注入することで、クラス自体は特定の依存関係に縛られず、再利用性が高まります。

1. **コードの可読性と保守性の向上**:
    - 依存関係が明示的になるため、コードの可読性と保守性が向上します。開発者はクラスがどのような依存関係を持つかを明確に理解できます。

#### DIの主要なパターン

DIにはいくつかの主要なパターンがあります。それぞれのパターンには、依存関係の注入方法が異なります。

1. **コンストラクタインジェクション**:
    - 依存関係をコンストラクタの引数として注入する方法です。最も一般的な方法で、依存関係が明示的に宣言されます。
    ```csharp
    public class MyClass
    {
        private readonly IDependency _dependency;

        public MyClass(IDependency dependency)
        {
            _dependency = dependency;
        }
    }
    ```

1. **プロパティインジェクション**:
    - 依存関係をプロパティを通じて注入する方法です。後から依存関係を設定する必要がある場合に有効です。
    ```csharp
    public class MyClass
    {
        public IDependency Dependency { get; set; }
    }
    ```

1. **メソッドインジェクション**:
    - 依存関係をメソッドの引数として注入する方法です。特定のメソッド呼び出しに依存関係が必要な場合に使用されます。
    ```csharp
    public class MyClass
    {
        public void DoSomething(IDependency dependency)
        {
            // メソッド内で依存関係を使用する
        }
    }
    ```

#### DIコンテナ

DIの実装を支援するために、DIコンテナ（依存性注入コンテナ）が使用されます。DIコンテナは、依存関係の解決と管理を自動化するためのフレームワークです。代表的なDIコンテナには、以下のものがあります。

- **Autofac**
- **Ninject**
- **Unity**
- **Microsoft.Extensions.DependencyInjection** (ASP.NET Coreに組み込まれているDIコンテナ)

DIコンテナは、依存関係の登録と解決を行い、コードの簡潔化と管理の効率化を助けます。

### 注意点

コンストラクターインジェクション、プロパティインジェクションを用いる場合、オブジェクトのライフタイムに気を配る必要があります。

仮にサービスAを用いるサービスがBがあった場合、サービスBのライフタイムをサービスA以下にする必要があります。
プロパティで参照してしまうと、実質的には破棄されているのに参照されているため有るように見えるオブジェクトが存在するなどの問題が発生するかもしれません。

### まとめ

DI（Dependency Injection）は、クラスの依存関係を外部から注入することで、コードの柔軟性、再利用性、テストの容易さを向上させるソフトウェア設計パターンです。DIの主要なパターンには、コンストラクタインジェクション、プロパティインジェクション、メソッドインジェクションがあり、これらを効果的に利用することで、コードの品質を向上させることができます。
